# 내부 클래스 (Inner Class) 장점 & 종류

- 내부 클래스는 중첩 클래스로 분류되기도 한다.


## 내부 클래스의 장점
---

### 1. 클래스를 논리적으로 그룹화

- 클래스가 여러 클래스와 관계를 맺지 않고 **하나의 특정 클래스와만 관계**를 맺는다면, 외부에 클래스를 새로 작성하는 것이 아닌 내부 클래스로 작성할 수 있다. 

- 내부 클래스와 외부 클래스를 함께 관리하는 것이 가능해서 유지보수 면에서나 코드 이해성 면에서 편리해진다.
- 내부 클래스로 인해 새로운 클래스를 생성하지 않아도 되므로 패키지를 간소화 할 수 있다.


### 2. 더욱 타이트한 캡슐화의 적용

- 내부 클래스에 private 제어자를 적용해줌으로써, 캡슐화를 통해 클래스를 내부로 숨길 수 있다.

- 캡슐화를 통해 외부에서의 접근을 차단하면서도, 내부 클래스에서 외부 클래스의 멤버들을 제약 없이 쉽게 접근할 수 있어 구조적인 프로그래밍이 가능해 진다.

- 클래스 구조를 숨김으로써 코드의 복잡성도 줄일 수 있다.


### 3. 가독성이 좋고 유지 관리가 쉬운 코드

- 한 클래스를 다른 클래스의 내부 클래스로 선언하면 두 클래스 멤버들 간에 서로 자유로이 접근할 수 있고, 그리고 외부에는 불필요한 클래스를 감춰서 클래스간의 연관 관계 따지는 것과 같은 코드의 복잡성을 줄일 수 있다는 장점이 있다.
- 간단하게 말하면 어느 한 클래스안에서만 사용하기 위한 클래스이기 때문에 내부에 선언해 직관적으로 사용하자는 말이다.





## 내부 클래스 종류 4가지 
---

- 내부 클래스는 총 4가지가 있는데, 이중에서 중점적으로 봐야할 요소는 static클래스와 익명 클래스 이다.
- static 클래스는 디자인 패턴에서 싱글톤 패턴과 Holder 패턴에서 쓰이는 기법중 하나이고, 익명 클래스는 자바8의 람다 표현식의 기본 골자이기 때문이다.

![Pasted image 20231030011320](https://github.com/hyeonjaez/Cs-study/assets/50399586/d4f05faa-657d-4825-9d8c-7bc88fc3022c)


```java
class Outer {
	class InstanceInner { ... } // 인스턴스 클래스
	static class StaticInner { ... } // 스태틱 클래스

	void method1() {
		class localInner { ... } //지역 클래스
	}
}
```


### 인스턴스 클래스

- 클래스의 멤버 변수 선언부에 위치하고 static 키워드가 없는 내부 클래스
- 외부 클래스의 멤버로 취급되기 때문에 외부 클래스의 객체 먼저 생성한 후 내부 클래스의 객체를 생성이 가능하다
- 인스턴스 클래스 내부에는 instance 멤버만 선언할 수 있다. (static 멤버는 선언 불가)
- 주로 외부 클래스의 인스턴스 멤버들과 관련된 작업에 사용될 목적으로 선언된다.
- 내부 클래스는 다른 클래스에서 직접 사용하는 것보다 해당(외부) 클래스에서만 사용하는 것이 일반적이므로, 위의 메인 코드와 같이 내부 클래스의 인스턴스를 다른 클래스에서 만드는 경우는 드물다.


### 스태틱 클래스

- static 키워드가 붙은 내부 클래스
- 일반적인 static 필드 변수나 static 메서드와 똑같이 생각하면 안된다.
- static 클래스 내부에는 instance 멤버와 static 멤버 모두 선언 할 수 있다.
- 일반적인 static 메서드와 동일하게 외부 클래스의 인스턴스 멤버에는 접근이 불가하고, 정적(static) 멤버에만 접근할 수 있다.


### static 클래스에 대한 오해
---

- static 클래스라 static이니까 메모리에 하나만 올라가는 인스턴스로 착각을 한다.
- 결론부터 말하면 static 클래스는, 키워드가 static이 들어갔을 뿐이지, 우리가 알던 static 멤버와는 전혀 다른 녀석이다.
- 내부 static 클래스는 일반 클래스처럼 초기화를 할때마다 다른 객체가 만들어짐을 볼 수 있다. (static 인데 말이다)

- [**static 클래스는 static이라고 해서 메모리에 한번만 로드되는 객체 개념이 아니다.**]
- 내부 인스턴스 클래스 처럼 외부 인스턴스를 먼저 선언하고 초기화해야 하는 선수 작업 필요 없이, 내부 클래스의 인스턴스를 바로 생성 할 수 있다는 차이점이 존재 할 뿐이다.

### 내부클래스는 static 클래스로 선언하자
---

- 내부 클래스에서 바깥 외부의 인스턴스를 사용할 일이 없다면 **static 클래스로 선언**해주어야 한다.

- static이 아닌 내부 인스턴스 클래스는 외부와 연결이 되어 있어 '외부 참조'를 갖게되어 메모리를 더 먹고, 느리며, 또한 GC 대상에서 제외되는 여러 문제점을 일으키기 때문이다.






### Inner 클래스의 문제점
---
- inner클래스는 inner static 클래스보다 메모리를 더 먹고, 더 느리고, 바깥 클래스가 GC 대상에서 빠져 버려 메모리 관리가 안될 수 있다.


### Inner 클래스는 외부 참조를 한다
---
- 내부 인스턴스 클래스를 만들기 위해서 먼저 외부 클래스를 초기화한뒤 내부 클래스를 초기화 해야하는데 이로 인해 inner 클래스는 자신을 만들어준 인스턴스에 대한 '외부참조'를 갖게 된다.
- 비 정적 멤버 클래스의 인스턴스는 바깥 클래스의 인스턴스와 연결된다.

### Inner 클래스의 메모리 누수 현상
---
- 위와 같은 기능적 장점보다는 외부 참조로 인한 메모리 누수 라는 치명적인 단점이 존재한다.
- Inner 클래스가 바깥 클래스를 외부 참조 함으로써, 만일 외부 클래스는 필요가 없어지고 내부 클래스만 남아 있을 경우, 필요없어진 외부 클래스를 GC대상으로 삼아 메모리에서 제거해야 되지만 외부 참조로 내부 클래스와 연결되어 있기 때문에 메모리에서 제거가 안되고 잔존하게 되고 이는 곧 메모리 누수로 프로그램이 터지게 된다.




### 내부 클래스는 static으로 선언하자 
---

1. static inner 클래스는 외부 참조를 안한다
2. static inner 클래스는 메모리 누수가 없다


- 정적 멤버 클래스는 외부 인스턴스 없이도 만들어질 수 있기 때문에 '외부 참조'가 존재하지 않게 되고, 이로 인해 일회용으로 사용된 바깥 클래스 객체는 더이상 내부 클래스 객체와 아무런 관계가 아니게 되어 정상적으로 GC 수거 대상이 되어 메모리 관리가 잘 된다.
- 정리하자면, inner 클래스를 선언할때 static 키워드를 붙여주지 않으면 '외부 참조' 현상 때문에, 내부 클래스 인스턴스를 생성하기 위해 우선적으로 만들었던 외부 클래스 인스턴스가 정상적으로 GC 수거가 안되 메모리에 잔존하게 되어 문제점을 일으키게 된다. 따라서 **내부 클래스가 외부 클래스의 멤버를 가져와 사용하는 경우가 아닌 경우** 반드시 내부 클래스를 선언 할 때는 **static 키워드를 붙여주어야** 한다
